# -*- coding: utf-8 -*-
"""
é€šç”¨æ¨¡æ¿åŠ è½½ä¸å¡«å……æ¨¡å—
æ ¸å¿ƒåŠŸèƒ½ï¼šåŠ è½½æ‰€æœ‰ä¼šè®®åœºæ™¯çš„é€šç”¨æ¨¡æ¿ï¼Œå°†æå–çš„ä¿¡æ¯æ ‡å‡†åŒ–å¡«å……
æ”¯æŒæ¨¡æ¿ï¼šé€šç”¨å•†åŠ¡/é¡¹ç›®åŒæ­¥/éœ€æ±‚è¯„å®¡/å‘¨ä¾‹ä¼šï¼Œå¯æ— é™æ‰©å±•
ä»…Pythonè¯­æ³•ç¼–å†™ï¼Œæ— å®é™…æ–‡ä»¶è¯»å–ï¼Œæ¨¡æ‹Ÿæ¨¡æ¿åŠ è½½
"""
# ğŸ‘‡ è¡¥å……å…³é”®å¯¼å…¥ï¼šæ‰€æœ‰ç±»å‹æ³¨è§£å¿…é¡»å…ˆå¯¼å…¥æ‰èƒ½ä½¿ç”¨
from typing import Dict, Any, List

def load_all_templates() -> Dict[str, Dict[str, str]]:
    """
    åŠ è½½æ‰€æœ‰é€šç”¨ä¼šè®®æ¨¡æ¿ï¼Œè¿”å›æ¨¡æ¿å­—å…¸
    æ¨¡æ¿ç»“æ„ï¼šç»Ÿä¸€æ ‡å‡†åŒ–æ’ç‰ˆï¼Œé€‚é…åŠå…¬åœºæ™¯ï¼Œå¯æŒ‰éœ€æ‰©å±•æ–°æ¨¡æ¿
    :return: æ‰€æœ‰æ¨¡æ¿å­—å…¸ï¼Œkey=æ¨¡æ¿åç§°ï¼Œvalue=æ¨¡æ¿å†…å®¹
    """
    # é€šç”¨æ¨¡æ¿åº“ï¼šæ”¯æŒå¤šåœºæ™¯ï¼Œç»Ÿä¸€æ’ç‰ˆé£æ ¼ï¼Œå¯ç›´æ¥æ‰©å±•
    all_templates = {
        # æ¨¡æ¿1ï¼šé€šç”¨å•†åŠ¡ä¼šè®®
        "é€šç”¨å•†åŠ¡ä¼šè®®": {
            "title": "{ä¼šè®®æ ¸å¿ƒä¿¡æ¯[ä¸»é¢˜]}",
            "basic_info": "## ä¸€ã€ä¼šè®®åŸºæœ¬ä¿¡æ¯\n- ä¼šè®®æ—¶é—´ï¼š{ä¼šè®®æ ¸å¿ƒä¿¡æ¯[ä¼šè®®æ—¶é—´]}\n- å‚ä¸äººï¼š{ä¼šè®®æ ¸å¿ƒä¿¡æ¯[å‚ä¸äºº]}\n- æ ¸å¿ƒè®®é¢˜ï¼š{ä¼šè®®æ ¸å¿ƒä¿¡æ¯[æ ¸å¿ƒè®®é¢˜]}",
            "resource_demand": "## äºŒã€åŒæ–¹èµ„æºä¸æ ¸å¿ƒè¯‰æ±‚\n{åŒæ–¹èµ„æº/è¯‰æ±‚}",
            "cooperation_plan": "## ä¸‰ã€åˆä½œæ¨¡å¼ä¸è½åœ°è§„åˆ’\n{åˆä½œæ¨¡å¼/è§„åˆ’}",
            "consensus": "## å››ã€æ ¸å¿ƒç»“è®ºä¸å…±è¯†\n{æ ¸å¿ƒç»“è®ºä¸å…±è¯†}",
            "to_do": "## äº”ã€å¾…åŠäº‹é¡¹ä¸è´£ä»»äºº\n{å¾…åŠäº‹é¡¹ä¸è´£ä»»äºº}",
            "risk": "## å…­ã€é—®é¢˜ä¸é£é™©ç‚¹\n{é—®é¢˜ä¸é£é™©ç‚¹}",
            "next_meeting": "## ä¸ƒã€ä¸‹æ¬¡ä¼šè®®å®‰æ’\n{ä¸‹æ¬¡ä¼šè®®å®‰æ’}"
        },
        # æ¨¡æ¿2ï¼šé¡¹ç›®åŒæ­¥ä¼šè®®ï¼ˆæ ¸å¿ƒé€šç”¨æ¨¡æ¿ï¼‰
        "é¡¹ç›®åŒæ­¥ä¼šè®®": {
            "title": "{ä¼šè®®æ ¸å¿ƒä¿¡æ¯[ä¸»é¢˜]}",
            "basic_info": "## ä¸€ã€ä¼šè®®åŸºæœ¬ä¿¡æ¯\n- ä¼šè®®æ—¶é—´ï¼š{ä¼šè®®æ ¸å¿ƒä¿¡æ¯[ä¼šè®®æ—¶é—´]}\n- å‚ä¸äººï¼š{ä¼šè®®æ ¸å¿ƒä¿¡æ¯[å‚ä¸äºº]}\n- ä¼šè®®æ—¶é•¿ï¼š{ä¼šè®®æ ¸å¿ƒä¿¡æ¯[ä¼šè®®æ—¶é•¿]}\n- æ ¸å¿ƒè®®é¢˜ï¼š{ä¼šè®®æ ¸å¿ƒä¿¡æ¯[æ ¸å¿ƒè®®é¢˜]}",
            "progress": "## äºŒã€é¡¹ç›®å½“å‰è¿›åº¦\n{é¡¹ç›®å½“å‰è¿›åº¦}",
            "resource": "## ä¸‰ã€èµ„æºéœ€æ±‚ä¸è·¨éƒ¨é—¨åè°ƒ\n{èµ„æºéœ€æ±‚ä¸åè°ƒ}",
            "execute_plan": "## å››ã€åç»­æ‰§è¡Œè®¡åˆ’ä¸æ—¶é—´èŠ‚ç‚¹\n{åç»­æ‰§è¡Œè®¡åˆ’}",
            "consensus": "## äº”ã€æ ¸å¿ƒç»“è®ºä¸å…±è¯†\n{æ ¸å¿ƒç»“è®ºä¸å…±è¯†}",
            "to_do": "## å…­ã€å¾…åŠäº‹é¡¹ä¸è´£ä»»äºº\n{å¾…åŠäº‹é¡¹ä¸è´£ä»»äºº}",
            "risk": "## ä¸ƒã€é¡¹ç›®é—®é¢˜ä¸é£é™©ç‚¹\n{é—®é¢˜ä¸é£é™©ç‚¹}",
            "next_meeting": "## å…«ã€ä¸‹æ¬¡ä¼šè®®å®‰æ’\n{ä¸‹æ¬¡ä¼šè®®å®‰æ’}"
        },
        # æ¨¡æ¿3ï¼šéœ€æ±‚è¯„å®¡ä¼šè®®
        "éœ€æ±‚è¯„å®¡ä¼šè®®": {
            "title": "{ä¼šè®®æ ¸å¿ƒä¿¡æ¯[ä¸»é¢˜]}",
            "basic_info": "## ä¸€ã€ä¼šè®®åŸºæœ¬ä¿¡æ¯\n- ä¼šè®®æ—¶é—´ï¼š{ä¼šè®®æ ¸å¿ƒä¿¡æ¯[ä¼šè®®æ—¶é—´]}\n- å‚ä¸äººï¼š{ä¼šè®®æ ¸å¿ƒä¿¡æ¯[å‚ä¸äºº]}\n- æ ¸å¿ƒè®®é¢˜ï¼š{ä¼šè®®æ ¸å¿ƒä¿¡æ¯[æ ¸å¿ƒè®®é¢˜]}",
            "demand_content": "## äºŒã€éœ€æ±‚æ ¸å¿ƒå†…å®¹\n{éœ€æ±‚æ ¸å¿ƒå†…å®¹}",
            "review_result": "## ä¸‰ã€éœ€æ±‚è¯„å®¡æ„è§ä¸ç»“è®º\n{è¯„å®¡æ„è§ä¸ç»“è®º}",
            "modify_require": "## å››ã€éœ€æ±‚ä¿®æ”¹è¦æ±‚ä¸æäº¤æµç¨‹\n{éœ€æ±‚ä¿®æ”¹è¦æ±‚}",
            "consensus": "## äº”ã€æ ¸å¿ƒç»“è®ºä¸å…±è¯†\n{æ ¸å¿ƒç»“è®ºä¸å…±è¯†}",
            "to_do": "## å…­ã€å¾…åŠäº‹é¡¹ä¸è´£ä»»äºº\n{å¾…åŠäº‹é¡¹ä¸è´£ä»»äºº}",
            "next_meeting": "## ä¸ƒã€ä¸‹æ¬¡ä¼šè®®å®‰æ’\n{ä¸‹æ¬¡ä¼šè®®å®‰æ’}"
        },
        # æ¨¡æ¿4ï¼šå‘¨åº¦ä¾‹ä¼š
        "å‘¨åº¦ä¾‹ä¼š": {
            "title": "{ä¼šè®®æ ¸å¿ƒä¿¡æ¯[ä¸»é¢˜]}",
            "basic_info": "## ä¸€ã€ä¼šè®®åŸºæœ¬ä¿¡æ¯\n- ä¼šè®®æ—¶é—´ï¼š{ä¼šè®®æ ¸å¿ƒä¿¡æ¯[ä¼šè®®æ—¶é—´]}\n- å‚ä¸äººï¼š{ä¼šè®®æ ¸å¿ƒä¿¡æ¯[å‚ä¸äºº]}\n- æ ¸å¿ƒè®®é¢˜ï¼š{ä¼šè®®æ ¸å¿ƒä¿¡æ¯[æ ¸å¿ƒè®®é¢˜]}",
            "week_complete": "## äºŒã€æœ¬å‘¨å·¥ä½œå®Œæˆæƒ…å†µ\n{æœ¬å‘¨å·¥ä½œå®Œæˆæƒ…å†µ}",
            "week_plan": "## ä¸‰ã€ä¸‹å‘¨å·¥ä½œè®¡åˆ’ä¸ä¼˜å…ˆçº§\n{ä¸‹å‘¨å·¥ä½œè®¡åˆ’}",
            "work_difficulty": "## å››ã€å·¥ä½œéš¾ç‚¹ä¸ååŠ©éœ€æ±‚\n{å·¥ä½œéš¾ç‚¹ä¸ååŠ©éœ€æ±‚}",
            "consensus": "## äº”ã€æ ¸å¿ƒç»“è®ºä¸å…±è¯†\n{æ ¸å¿ƒç»“è®ºä¸å…±è¯†}",
            "to_do": "## å…­ã€å¾…åŠäº‹é¡¹ä¸è´£ä»»äºº\n{å¾…åŠäº‹é¡¹ä¸è´£ä»»äºº}",
            "next_meeting": "## ä¸ƒã€ä¸‹æ¬¡ä¾‹ä¼šå®‰æ’\n{ä¸‹æ¬¡ä¼šè®®å®‰æ’}"
        }
    }
    return all_templates

def fill_template(extract_result: Dict[str, Any], template: Dict[str, str]) -> str:
    """
    é€šç”¨æ¨¡æ¿å¡«å……ï¼šå°†æå–çš„ç»“æ„åŒ–ä¿¡æ¯ï¼Œæ ‡å‡†åŒ–å¡«å……åˆ°é€‰ä¸­çš„æ¨¡æ¿ä¸­
    é€‚é…æ‰€æœ‰æ¨¡æ¿ï¼Œè‡ªåŠ¨åŒ¹é…å˜é‡ï¼Œç»Ÿä¸€è¾“å‡ºæ ‡å‡†åŒ–æ’ç‰ˆçš„çºªè¦æ–‡æœ¬
    :param extract_result: é€šç”¨æå–çš„ç»“æ„åŒ–ä¼šè®®ä¿¡æ¯
    :param template: é€‰ä¸­çš„é€šç”¨ä¼šè®®æ¨¡æ¿
    :return: æ ‡å‡†åŒ–ã€ç»“æ„åŒ–çš„é€šç”¨ä¼šè®®çºªè¦æ–‡æœ¬
    """
    # é€šç”¨å˜é‡å¡«å……ï¼šé€’å½’æ›¿æ¢æ¨¡æ¿ä¸­çš„æ‰€æœ‰å˜é‡ï¼Œé€‚é…æ‰€æœ‰æ¨¡æ¿ç»“æ„
    def fill_recursive(data: Any) -> Any:
        if isinstance(data, str):
            filled_str = data
            # éå†æå–ç»“æœï¼Œæ›¿æ¢æ‰€æœ‰å˜é‡ï¼ˆæ”¯æŒä¸€çº§/äºŒçº§å˜é‡ï¼Œå¦‚{key}/{key[sub_key]}ï¼‰
            for key, value in extract_result.items():
                if isinstance(value, dict):
                    for sub_key, sub_value in value.items():
                        filled_str = filled_str.replace(f"{{{key}[{sub_key}]}}", str(sub_value))
                else:
                    filled_str = filled_str.replace(f"{{{key}}}", str(value))
            return filled_str
        elif isinstance(data, dict):
            return {k: fill_recursive(v) for k, v in data.items()}
        else:
            return data
    
    # å¡«å……æ¨¡æ¿å˜é‡
    filled_template = fill_recursive(template)
    
    # é€šç”¨æ ‡å‡†åŒ–æ‹¼æ¥ï¼šæŒ‰æ¨¡æ¿é¡ºåºæ‹¼æ¥ï¼Œç”Ÿæˆç»Ÿä¸€æ’ç‰ˆçš„çºªè¦æ–‡æœ¬
    summary_text = f"# {filled_template['title']}\n\n"
    # éå†æ¨¡æ¿ï¼ŒæŒ‰é¡ºåºæ·»åŠ å†…å®¹ï¼ˆè·³è¿‡titleï¼Œå·²å•ç‹¬æ‹¼æ¥ï¼‰
    for key, value in filled_template.items():
        if key != "title" and value:
            summary_text += value + "\n\n"
    
    return summary_text

# é€šç”¨æµ‹è¯•ï¼ˆä»…Pythonè¯­æ³•ï¼Œæ— å®é™…æ‰§è¡Œï¼‰
if __name__ == '__main__':
    # æµ‹è¯•æ¨¡æ¿åŠ è½½ä¸å¡«å……
    test_templates = load_all_templates()
    test_extract = {
        "ä¼šè®®æ ¸å¿ƒä¿¡æ¯": {"ä¸»é¢˜": "æµ‹è¯•å‘¨åº¦ä¾‹ä¼š", "ä¼šè®®æ—¶é—´": "2026-XX-XX", "å‚ä¸äºº": "å…¨ä½“å‘˜å·¥", "æ ¸å¿ƒè®®é¢˜": "æœ¬å‘¨å·¥ä½œå¤ç›˜"}
    }
    print(fill_template(test_extract, test_templates["å‘¨åº¦ä¾‹ä¼š"]))
